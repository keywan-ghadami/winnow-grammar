# Upstream Compatibility and Project Roadmap

This document outlines the current feature set of `winnow-grammar` and tracks the roadmap for future development, particularly concerning features adapted from or inspired by `syn-grammar`.

## Project Status

`winnow-grammar` has matured significantly and now implements the majority of its initial feature goals. It provides a stable foundation for building parsers using an EBNF-like syntax that compiles directly to high-performance `winnow` code.

The focus of development has shifted from core features to advanced capabilities and quality-of-life improvements.

---

## Completed and Implemented Features

The following major features are fully implemented and documented in the `README.md`.

- **Core EBNF Syntax**: Support for sequences, alternatives (`|`), optionals (`?`), repetitions (`*`, `+`), and grouping (`(...)`).
- **Direct Left Recursion**: The grammar compiler automatically detects and transforms direct left-recursive rules into efficient iterative parsers.
- **Configurable Whitespace Handling**: The automatic whitespace parser can be overridden by defining a rule named `ws`. If present, this rule will be used to consume whitespace between tokens; otherwise, a default of `multispace0` is used.
- **Rule Arguments**: Rules can accept arguments, allowing for contextual parsing.
- **Span Information**: The `@` operator allows capturing the source span of a parsed element.
- **Cut Operator (`=>`)**: Provides a mechanism to commit to a parsing path, preventing backtracking and improving error messages.
- **Integration with External Parsers**: Seamlessly call any external `winnow`-compatible parser from within a grammar rule.
- **`use` Statements**: `use` statements are supported directly within the `grammar!` block for importing necessary types.
- **Rich Set of Built-ins**: A wide array of built-in parsers are available (e.g., `ident`, `integer`, `string`).
- **Attributes on Rules**: Standard Rust attributes (`#[...]`) can be placed on rules and are passed through to the generated parser functions.

---

## Roadmap: Needed and Future Features

This section outlines the high-priority features planned for future releases.

### 1. Parameterized Rules (Generics)
- **Priority**: High
- **Description**: The ability to define generic, reusable rules. This is the most significant missing feature for reducing boilerplate in complex grammars.
- **Example Syntax**:
  ```rust
  // Define a generic rule for a comma-separated list
  rule separated_list<T>(p: impl Parser<T>) -> Vec<T> =
      first:p rest:("," p)* -> { ... }

  // Use it
  rule main -> Vec<i32> = separated_list(integer)
  ```

### 2. Indirect Left Recursion
- **Priority**: Medium
- **Description**: The current engine only supports direct left recursion (e.g., `expr = expr "+" term`). The next step is to support indirect or mutual left recursion (e.g., `a = b; b = a;`). This requires a more advanced graph-based analysis of rule dependencies.
- **Status**: This is a complex feature that requires significant research and development.

### 3. Improved Error Reporting
- **Priority**: Low
- **Description**: While the cut operator helps, the errors generated by the macro itself (when the grammar definition is invalid) could be improved. The goal is to provide more specific and helpful compile-time errors.
